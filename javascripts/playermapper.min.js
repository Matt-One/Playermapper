/*! Playermapper - CDawg [20170816] */
var site=document.domain;var char_matrix=map_matrix=1;var map_buffer="";var zoom=100;var zoom_max=350;var zoom_min=25;var map_x=map_y=zone=map_count=click_stop=0;var dk_zone=1;var click_delay=80;var cMenu="menu_placement";var cRealm="";var screen=["x","y"];var map_drag=["x","y"];var menu_nav=[0,0];var menu_console=[0,0];var menu_minimap=[0,0];var cursor=["x","y"];var menu_matrix;function getElementsStartsWithId(id){var children=document.body.getElementsByTagName('*');var elements=[], child;for (var i=0, length=children.length; i < length; i++) {child=children[i];if(child.id.substr(0, id.length)==id)elements.push(child);}return elements;}var console_load_delay=20;function pmconsole(log, header){if(header){$("#console_data").append('<div class="console_header">'+log+'</div>');}else {$("#console_data").append('<div class="console_line">'+log+'</div>');}$("#console").animate({ scrollTop: $("#console")[0].scrollHeight}, console_load_delay);$(".console_line").hover(function(){var fp=$(this).text();var zone_name="";fp=fp.substring(0, fp.indexOf(' - ')).toLowerCase();var footprint=getElementsStartsWithId(fp);if(fp){$(".fp").hide();if($(".fp")){$(footprint).show();$(".fp_searchmarker").show().css({"zoom":"4","opacity":"0.6"}).animate({"zoom": "1","-moz-transform":"scale(1)"}, 100);}setTimeout(function(){$(".fp_searchmarker").hide();$(".fp").show();}, 400);}else{var zone=$(this).text().toLowerCase().replace(/'/g, '');var zone_name='[name="'+zone+'"]';$(zone_name).css({"opacity":"0"});$(zone_name).css({"opacity":"0.4"});}},function() {$(".zone-bind").css({"opacity":"0"});$(".zone-bind").hover(function(){$(this).css({"opacity":"0.3"});},function() {$(this).css({"opacity":"0"});});}).delay(500).stop();}function showCharMatrix(){if(char_matrix){$("#char_matrix").hide();char_matrix=0;}else{$("#char_matrix").show();char_matrix=1;}}function showMapMatrix(){if(map_matrix){$(".map").css('background-image', 'none');$("#dk_zone").hide();map_matrix=0;dk_zone=0;}else{$(".map").css('background-image', map_buffer);$("#dk_zone").show();$("#checkbox_dkstart").prop("checked", true);map_matrix=1;dk_zone=1;$(".dk").show();}}function showMapZones(){if(!zone){$(".zone-bind").css("opacity", "0.4");zone=1;}else{$(".zone-bind").css("opacity", "0.0");$(".zone-bind").hover(function(){$(this).css("opacity", "0.4");}, function(){$(this).css("opacity", "0.0");});zone=0;}}function showDKZone(){if(dk_zone){$("#dk_zone").fadeOut(500).css({"borderColor":"transparent"});$(".dk").fadeOut(500);dk_zone=0;}else{$("#dk_zone").fadeIn(500).css({"borderColor":"#4d4d4d"});$(".dk").fadeIn(500);dk_zone=1;}}function zoneIdentity(name){$("#minimap_title").html(name);$("#minimap_title").css({"background":"#605f53"});setTimeout(function(){$("#minimap_title").css({"background":"-webkit-linear-gradient(#656565, #181818)","background":"-o-linear-gradient(#656565, #181818)","background":"-moz-linear-gradient(#656565, #181818)","background":"linear-gradient(#656565, #181818)"});}, 50);}function toTitleCase(str){return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});}function mapCount(){map_count+= 1;$("#map_count").html(map_count);$("#minimap_details").css({"background":"#605f53"});setTimeout(function(){$("#minimap_details").css({"background":"#181818"});}, 10);}function loadCharacterFP(load){var load_delay=console_load_delay *4;if(!load){load_delay=0;}$(".fp_searchmarker").each(function( index ) {setTimeout(function(){fpsm="#sm_"+(index+1);var fp_id=$(fpsm).parent().prop("id");if(load){$("#"+fp_id).show();}var fp_ex=fp_id.replace("_", " - ");var fp=fp_ex.charAt(0).toUpperCase()+fp_ex.slice(1);if(load){pmconsole(toTitleCase(fp));mapCount();}$(fpsm).show();$(fpsm).stop().css({"zoom":"6","-moz-transform":"scale(5)"}).animate({"zoom": "1","-moz-transform":"scale(1)"}, 500).delay(20).css({"opacity":"0.4"}).animate({"opacity":"0"}, 600);}, load_delay * index);});}function zoneZoom(zone){/*pmconsole($("#"+zone).attr("name"));*/if(click_stop){return;}if(zone=="zone_5416"){window.location.href="Deepholm";return;}if(zoom <= 140){setTimeout(function(){$(".map").css({"left":(screen[0] /4 - cursor[0]-100)+"px","top":(screen[1] /4 - cursor[1]-100)+"px"});}, 300);setTimeout(function(){zoom=zoom_max;$(".map").css({"zoom":zoom+"%","-moz-transform":"scale("+zoom/100+")"});$("#zoom_slider").slider({value: zoom});$("#custom-handle").text(zoom);}, 50);}}$(function(){var map_id=$(".map").prop("id");var expansion=$("#expansion").text();var expansionPath="";var version=$("#version").text();screen[0]=$(window).width();screen[1]=$(window).height();pmconsole("Playermapper:", true);pmconsole(version);pmconsole("Expansion:", true);pmconsole(expansion);pmconsole("Browser Resolution:", true);pmconsole(screen[0]+"x"+screen[1]);pmconsole("Loading Map Matrix:", true);pmconsole(map_id.charAt(0).toUpperCase()+map_id.slice(1));if(map_id=="azeroth"){expansionPath=expansion+"/";}var zonejsonPath="json/"+expansionPath+map_id+".json";pmconsole("Loading Zone Matrix:", true);$.getJSON(zonejsonPath, function(data){for (i=0; i<data[0]["zone"].length; i++){pmconsole(data[0]["zone"][i]["name"]);}});$( document ).on( "mousemove", function( event ) {cursor[0]=event.pageX;cursor[1]=event.pageY;});var handle=$("#custom-handle");$("#zoom_slider").slider({range: "min",value: zoom,min: zoom_min,max: zoom_max,create: function() {handle.text( $( this ).slider( "value" ) );},slide: function( event, ui ) {handle.text( ui.value );zoom=ui.value;$(".map").css({"zoom":zoom+"%","-moz-transform":"scale("+zoom/100+")","margin-left":-zoom*1.3+"px","margin-top":-zoom*0.6+"px"});}});setTimeout(function(){map_buffer=$(".map").css('background-image');map_center_x=$(".map").css('background-image');}, 1000);setTimeout(function(){pmconsole("Loading Character Matrix:", true);loadCharacterFP(true);}, 200);$(".map").draggable({cursor:"move",drag: function(){var offset=$(this).offset();map_drag[0]=offset.left;map_drag[1]=offset.top;click_stop=1;},stop: function(){setTimeout(function(){click_stop=0;}, click_delay);}});if($.cookie(cMenu)){menu_matrix=$.cookie(cMenu);var menu_pos=menu_matrix.split(",");}/*$("#nav_menu").draggable({handle: "#nav_title",drag: function(){var offset=$(this).offset();menu_nav[0]=offset.left;menu_nav[1]=offset.top;menu_matrix=menu_nav[0]+","+menu_nav[1]+","+menu_minimap[0]+","+menu_minimap[1]+","+menu_console[0]+","+menu_console[1];$.cookie(cMenu, menu_matrix, {path : '/', domain : site, expires : 1});},});$("#minimap").draggable({handle: "#minimap_title",drag: function(){var offset=$(this).offset();menu_minimap[0]=offset.left;menu_minimap[1]=offset.top;menu_matrix=menu_nav[0]+","+menu_nav[1]+","+menu_minimap[0]+","+menu_minimap[1]+","+menu_console[0]+","+menu_console[1];$.cookie(cMenu, menu_matrix, {path : '/', domain : site, expires : 1});},});$("#console").draggable({handle: "#console_title",drag: function(){var offset=$(this).offset();menu_console[0]=offset.left;menu_console[1]=offset.top;menu_matrix=menu_nav[0]+","+menu_nav[1]+","+menu_minimap[0]+","+menu_minimap[1]+","+menu_console[0]+","+menu_console[1];$.cookie(cMenu, menu_matrix, {path : '/', domain : site, expires : 1});},});*/$(".map").mousewheel(function(turn, delta){if(delta==1){if(zoom>zoom_max-5)return false;zoom+=5;}else {if(zoom<zoom_min+5)return false;zoom-=5;}$(this).css({"zoom": zoom+"%","-moz-transform":"scale("+zoom/100+")","margin-left":-zoom*1.1+"px","margin-top":-zoom*0.6+"px"});$("#zoom_slider").slider({value: zoom});$("#custom-handle").text(zoom);return false;});$(".map").mousedown(function(e){if( e.button==2 ) {zoomReset();return false;}return true;});/*$("#help").animate({marginLeft:"-300px", opacity:0.7}, 2000);setTimeout(function(){$("#help").animate({marginLeft:"-30px", opacity:0.4}, 2000);}, 5000);*/$(".fp").hover(function() {var fp_details=$(this).children().text();$("#fp_detail").html(fp_details.replace(']', ']<br>'));$("#fp_detail").show();}, function() {$("#fp_detail").hide();});/*setTimeout(function(){$("#char_matrix" ).load("matrix.php");}, 7000);*/});var helpExt=0;function openHelp(){if(helpExt){helpExt=0;$("#help").animate({marginLeft:"-30px", opacity:0.7}, 700);}else {helpExt=1;$("#help").animate({marginLeft:"-300px", opacity:0.7}, 700);}}$(window).mousemove(function(e){$("#fp_detail").css({'top': e.clientY+15, 'left': e.clientX+15})});function mapShift(dir){if(dir==1){map_y+=50;$('.map').css("top", map_y+map_drag[1]);}else if(dir==2){map_y -=50;$('.map').css("top", map_y+map_drag[1]);}else if(dir==3){map_x+=50;$('.map').css("left", map_x+map_drag[0]);}else if(dir==4){map_x -=50;$('.map').css("left", map_x+map_drag[0]);}else{map_x=map_y=map_drag[0]=map_drag[1]=0;mapResetPos();}}function zoomReset(){zoom=100;mapShift(0);$("#zoom_slider").slider({value: zoom});$("#custom-handle").text(zoom);$(".map").css({"zoom":zoom+"%","-moz-transform":"scale("+zoom/100+")",});}function search(e){var eventInstance=window.event ? event : e;var keyCode=eventInstance.charCode ? eventInstance.charCode : eventInstance.keyCode;if((keyCode==13) || (e=="click")){var query=$("#search_in").val();if((query != "*") && (query != "%") && (query.length > 1)){/*Search Zones*//*$("#"+zone).attr("name");*/var footprint=getElementsStartsWithId(query);$(".fp").hide();loadCharacterFP(false);if($(".fp")){$(footprint).show();}}else {alert("Invalid query!\n\nPlease enter a zone or player name.\nMinimum 2 characters in length");}}else{if(e=="cancel"){$(".fp").show().css({"fontSize" : "10pt","textShadow" : "0px 0px 1px #fff","marginLeft" : "0px","marginTop" : "0px",});$("#search_in").val("");}}}