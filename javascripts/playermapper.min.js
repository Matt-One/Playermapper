/*! Playermapper - CDawg [20170803] */
var site=document.domain;var char_matrix=map_matrix=1;var map_buffer="";var zoom=100;var zoom_max=350;var zoom_min=25;var map_x=map_y=map_drag_x=map_drag_y=screen_x=screen_y=cursor_x=cursor_y=zone=0;var dk_zone=1;function console(log, header){if(header){$("#console_data").append("<br><b>"+log+"</b>");}else {$("#console_data").append("<br>"+log);}$("#console").animate({ scrollTop: $("#console")[0].scrollHeight}, 10);}function showCharMatrix(){if(char_matrix){$("#char_matrix").hide();char_matrix=0;}else{$("#char_matrix").show();char_matrix=1;}}function showMapMatrix(){if(map_matrix){$(".map").css('background-image', 'none');$("#dk_zone").hide();map_matrix=0;dk_zone=0;}else{$(".map").css('background-image', map_buffer);$("#dk_zone").show();$("#checkbox_dkstart").prop("checked", true);map_matrix=1;dk_zone=1;$(".dk").show();}}function showMapZones(){if(!zone){$(".zone-bind").css("opacity", "0.4");zone=1;}else{$(".zone-bind").css("opacity", "0.0");$(".zone-bind").hover(function(){$(this).css("opacity", "0.4");}, function(){$(this).css("opacity", "0.0");});zone=0;}}function showDKZone(){if(dk_zone){$("#dk_zone").fadeOut(500).css({"borderColor":"transparent"});$(".dk").fadeOut(500);dk_zone=0;}else{$("#dk_zone").fadeIn(500).css({"borderColor":"#4d4d4d"});$(".dk").fadeIn(500);dk_zone=1;}}function zoneIdentity(name){$("#minimap_title").html(name);$("#minimap_title").stop().css("background-color", "#717171").animate({ backgroundColor: "#181818"}, 500);}function toTitleCase(str){return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});}function loadCharacterFP(load){$(".fp_searchmarker").each(function( index ) {setTimeout(function(){fpsm="#sm_"+(index+1);var fp_id=$(fpsm).parent().prop("id");$("#"+fp_id).css({"display":"inline"});var fp_ex=fp_id.replace("_", " - ");var fp=fp_ex.charAt(0).toUpperCase()+fp_ex.slice(1);if(load){console(toTitleCase(fp));}$(fpsm).show();$(fpsm).stop().css({"zoom":"20","-moz-transform":"scale(5)"}).animate({"zoom": "1","-moz-transform":"scale(1)"}, 500).delay(20).css({"opacity":"0.6"}).animate({"opacity":"0"}, 600);}, 60 * index);});}function zoneZoom(zone){$("#"+zone).dblclick(function(){if(zoom <= 140){setTimeout(function(){$(".map").css({"top":(screen_y /4 - cursor_y-100)+"px","left":(screen_x /4 - cursor_x-100)+"px"});}, 300);setTimeout(function(){zoom=350;$(".map").css({"zoom": zoom+"%"});$("#zoom_val").text(zoom+'%');}, 50);}});}$( function(){var map_id=$(".map").prop("id");var expansion=$("#expansion").text();var expansionPath="";var version=$("#version").text();screen_x=$(window).width();screen_y=$(window).height();console("Playermapper:", true);console(version+"+"+expansion+"<br>");console("Browser Resolution:", true);console(screen_x+"x"+screen_y+"<br>");console("Loading Map Matrix:", true);console(map_id.charAt(0).toUpperCase()+map_id.slice(1)+"<br>");if(map_id=="azeroth"){expansionPath=expansion+"/";}var zonejsonPath="json/"+expansionPath+map_id+".json";console("Loading Zone Matrix:", true);$.getJSON(zonejsonPath, function(data){for (i=0; i<data[0]["zone"].length; i++){console(data[0]["zone"][i]["name"]);}});$( document ).on( "mousemove", function( event ) {cursor_x=event.pageX;cursor_y=event.pageY;});setTimeout(function(){map_buffer=$(".map").css('background-image');map_center_x=$(".map").css('background-image');}, 1000);setTimeout(function(){console("<br><b>Loading Character Matrix:</b>");loadCharacterFP(true);}, 200);$(".map").draggable({cursor:"move",drag: function(){var offset=$(this).offset();map_drag_x=offset.left;map_drag_y=offset.top;}});$(window).mousewheel(function(turn, delta){if(delta==1){if(zoom>zoom_max-5)return false;zoom+=5;}else {if(zoom<zoom_min+5)return false;zoom-=5;}$(".map").css({"zoom": zoom+"%","-moz-transform":"scale("+zoom/100+")"});$("#zoom_val").text(zoom+'%');return false;});});$(window).mousemove(function(e){if((zoom > 120) || (zoom < 80)){$(".fp_details").css({'top':"50px", 'left':"100%", "marginLeft":"-200px"});}else{$(".fp_details").css({'top': e.clientY+15, 'left': e.clientX+15})}});function mapShift(dir){if(dir==1){map_y+=50;$('.map').css("top", map_y+map_drag_y);}else if(dir==2){map_y -=50;$('.map').css("top", map_y+map_drag_y);}else if(dir==3){map_x+=50;$('.map').css("left", map_x+map_drag_x);}else if(dir==4){map_x -=50;$('.map').css("left", map_x+map_drag_x);}else{map_x=map_y=map_drag_x=map_drag_y=0;mapResetPos();}}function mapZoom(zdir){if(zoom >= zoom_max){zoom=zoom_max-1;return;}if(zoom <= zoom_min){zoom=zoom_min+1;return}if(zdir==2){zoom+=5;}else if(zdir==1){zoom-=5.0;}else{zoom=100;mapShift(0);}$(".map").css({"zoom":zoom+"%","-moz-transform":"scale("+zoom/100+")"});$("#zoom_val").text(zoom+"%");}function getElementsStartsWithId( id ){var children=document.body.getElementsByTagName('*');var elements=[], child;for (var i=0, length=children.length; i < length; i++) {child=children[i];if(child.id.substr(0, id.length)==id)elements.push(child);}return elements;}function search(e){var eventInstance=window.event ? event : e;var keyCode=eventInstance.charCode ? eventInstance.charCode : eventInstance.keyCode;if((keyCode==13) || (e=="click")){var query=$("#search_in").val();if((query != "*") && (query != "%") && (query.length > 1)){var footprint=getElementsStartsWithId(query);$(".fp").hide();loadCharacterFP(false);if($(".fp")){$(footprint).show();}}else {alert("Invalid query!\n\nPlease enter a zone or player name.\nMinimum 2 characters in length");}}else{if(e=="cancel"){$(".fp").show().css({"fontSize" : "10pt","textShadow" : "0px 0px 1px #fff","marginLeft" : "0px","marginTop" : "0px",});$("#search_in").val("");}}}